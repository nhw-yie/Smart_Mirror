<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Smart Mirror Dashboard</title>
  <style>
    body { font-family: sans-serif; background:#222; color:#eee; padding:20px; }
    .section { margin-bottom: 18px; padding:12px; border-radius:8px; background:#2b2b2b; }
    .label { color:#bbb; margin-right:6px; }
    #image_area img { max-width:100%; height:auto; border-radius:8px; margin-top:8px; }
  </style>
</head>
<body>
  <h2>ğŸª Smart Mirror Dashboard</h2>

  <div class="section">
    <div><span class="label">Thiáº¿t bá»‹:</span> <span id="device">{{ state.device }}</span></div>
    <div><span class="label">WiFi:</span> <span id="wifi">{{ state.wifi }}</span></div>
    <div><span class="label">Äá»‹a chá»‰ IP:</span> <span id="ip">{{ state.ip }}</span></div>
    <div><span class="label">Sá»± kiá»‡n:</span> <span id="event">{{ state.last_event }}</span></div>
    <div><span class="label">Voice mode:</span> <span id="voice_mode">{{ state.voice_mode }}</span></div>
    <div><span class="label">Voice reply:</span> <span id="voice_reply">{{ state.last_voice_response }}</span></div>
  </div>

  <div class="section">
    <h3>Sensor</h3>
    <div><span class="label">ğŸŒ¡ï¸ Nhiá»‡t Ä‘á»™:</span> <span id="temp">{{ state.temperature or "?" }} Â°C</span></div>
    <div><span class="label">ğŸ’§ Äá»™ áº©m:</span> <span id="hum">{{ state.humidity or "?" }} %</span></div>
    <div><span class="label">ğŸ’¡ Ãnh sÃ¡ng:</span> <span id="light">{{ state.light or "?" }} %</span></div>
    <div><span class="label">ğŸŒ«ï¸ PM2.5:</span> <span id="pm25">{{ state.pm25 or "?" }} Âµg/mÂ³</span></div>
    <div><span class="label">ğŸŒ«ï¸ PM10:</span> <span id="pm10">{{ state.pm10 or "?" }} Âµg/mÂ³</span></div>
  </div>

  <div class="section" style="text-align:center;">
    <button onclick="fetch('/api/generate', {method:'POST'}).then(r=>r.json()).then(j=>showImage(j.url))">ğŸ¨ Táº¡o áº£nh</button>
    <div id="image_area">{% if state.generated_image %}<img src="{{ state.generated_image }}">{% endif %}</div>
  </div>

  <script>
    const evtSource = new EventSource("/events");
    evtSource.onmessage = function(e) {
      const data = JSON.parse(e.data);
      if (data.device !== undefined) document.getElementById("device").innerText = data.device;
      if (data.wifi !== undefined) document.getElementById("wifi").innerText = data.wifi;
      if (data.ip !== undefined) document.getElementById("ip").innerText = data.ip;
      if (data.last_event !== undefined) document.getElementById("event").innerText = data.last_event;
      if (data.last_update !== undefined) {/* not shown */}
      if (data.temperature !== undefined) document.getElementById("temp").innerText = data.temperature + " Â°C";
      if (data.humidity !== undefined) document.getElementById("hum").innerText = data.humidity + " %";
      if (data.light !== undefined) document.getElementById("light").innerText = data.light + " %";
      if (data.pm25 !== undefined) document.getElementById("pm25").innerText = data.pm25 + " Âµg/mÂ³";
      if (data.pm10 !== undefined) document.getElementById("pm10").innerText = data.pm10 + " Âµg/mÂ³";
      if (data.voice_mode !== undefined) document.getElementById("voice_mode").innerText = data.voice_mode;
      if (data.last_voice_response !== undefined) document.getElementById("voice_reply").innerText = data.last_voice_response;
      if (data.generated_image) showImage(data.generated_image);
    };

    function showImage(url) {
      const area = document.getElementById("image_area");
      area.innerHTML = `<img src="${url}" alt="Generated Image" />`;
    }
  </script>
</body>
</html>